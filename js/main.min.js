let salarioBase=1e6,horasPlus=document.getElementsByClassName("hora-ex"),subsidioTransporte=117172,deduccionAFP=0,deduccionEPS=0,horaBase=0,vrHrExDiOr=0,vrHrExDiDoFes=0,vrHrExNocOr=0,vrHrExNocFoFes=0,vrRecNocOr=0,vrRecNocDoFes=0,vrRecDom=0,horasNormales=0,recargoDominical=0,recargoDominicalNoc=0,recargoNocturnos=0,totalDom=0,totalDomNoc=0,totalNoc=0,totalExtraDom=0,totalExtraDomNoc=0,totalExtraNoc=0,totalOrdinaria=0,extraOrdinaria=0,extraDominicales=0,extrasDominicalesNoc=0,extrasNocturnas=0,horasXDomNoc=0,horasXNoc=0,horasXDom=0,horasXOrd=0,seleccionTurno=document.getElementsByClassName("pre-turno"),clicked=null,selected=null,fecha=new Date,currentColor="",contenedor=null,turnSelect=null,dia=null,calendario=[],modal=document.querySelector(".modal"),cerrar=document.querySelector(".cerrar"),turno=document.querySelector("#turno"),horaExtras=0,diafechado=[],diaBuscado=null,terminar=document.querySelector(".terminar"),cerrarNomina=document.querySelector(".cerrarNomina"),drawPago=document.querySelector(".turnosContainer"),totales=document.querySelector(".totales"),guardar=document.querySelector(".confirmar");function generarCalendario(){fecha.setDate(1);let e=fecha.getMonth(),o=fecha.getDay(),a=fecha.getFullYear(),r=new Date(a,e+1,0).getDate(),t=new Date(a,e,0).getDate(),c=7-new Date(a,e+1,0).getDay()-1,n=document.querySelector(".mes"),l=document.querySelector(".dias-mes"),i={mes:e+1,ano:a};n.innerText=`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][fecha.getMonth()]} ${a}`;let s="";for(let e=o;e>0;e--)s+=`<div class='prev-days'><p>${t-e+1}</p></div>`;for(let o=1;o<=r;o++)s+=`<div class="day" id="a${a}_${e+1}_${o}"><p>${o}</p><div class="day-container" style="background-color: rgb(${currentColor}"></div></div>`,l.innerHTML=s;for(let e=0;e<c;e++)s+=`<div class='post-days'><p>${e+1}</div>`,l.innerHTML=s;recuperarFechas(),crEvent(i),cambiarEsquema()}function crEvent(e){let o=document.querySelectorAll(".day");for(let e=0;e<o.length;e++)o[e].addEventListener("click",a);function a(){evento(clicked=this,e)}}function evento(e,o){contenedor=e.lastChild,dia=e.firstChild.textContent,o.dia=Number(dia),openModal(diafechado=[o.ano,o.mes,o.dia])}function openModal(){modal.classList.add("modalOpen");for(let e=0;e<seleccionTurno.length;e++)seleccionTurno[e].addEventListener("click",turnInit)}function turnInit(){changeTurn(turnSelect=this)}function changeTurn(e){turno.value=e.textContent}function selecthe(){let e=null;for(let e=0;e<horasPlus.length;e++)horasPlus[e].addEventListener("click",o);function o(){!function(e){for(let e=0;e<horasPlus.length;e++)horasPlus[e].classList.remove("active");e.classList.add("active")}(e=this)}document.querySelector(".plus0").addEventListener("click",()=>{horaExtras=0,recuperarFechas()}),document.querySelector(".plus1").addEventListener("click",()=>{horaExtras=1,recuperarFechas()}),document.querySelector(".plus2").addEventListener("click",()=>{horaExtras=2,recuperarFechas()})}function agregarJson(e,o){null!=calendario.find(e=>e.fecha==o.toString())?(calendario.find(e=>e.fecha==o.toString()).horario=e,calendario.find(e=>e.fecha==o.toString()).horaExtras=horaExtras):calendario.push({fecha:o.toString(),horario:e,horaExtras:horaExtras}),calendario.sort(function(e,o){return(e=new Date(e.fecha))>(o=new Date(o.fecha))?-1:e<o?1:0}),modal.classList.remove("modalOpen")}function recuperarFechas(){calendario.forEach(e=>reescribirFecha(e))}function reescribirFecha(e){let o="#a"+e.fecha.replace(/,/g,"_");null!=(diaBuscado=document.querySelector(`${o}`))&&(0!=e.horaExtras?diaBuscado.lastChild.textContent=e.horario+" + "+e.horaExtras:diaBuscado.lastChild.textContent=e.horario,0!=turno.value&&diaBuscado.lastChild.classList.add("fulled"))}function consolidarNomina(e,o){horaBase=Math.round(salarioBase/240),vrHrExDiOr=Math.round(1.25*horaBase),vrHrExDiDoFes=Math.round(2*horaBase),vrHrExNocOr=Math.round(1.75*horaBase),vrHrExNocFoFes=Math.round(2.5*horaBase),vrRecNocOr=Math.round(.35*horaBase),vrRecNocDoFes=Math.round(1.1*horaBase),vrRecDom=Math.round(.75*horaBase),calendario.forEach(e=>{let o=new Date(e.fecha+","+e.horario);for(let e=0;e<8;e++)calcNomina(o);o.setTime(o.getTime()+27e5);for(let a=0;a<4*e.horaExtras;a++)calcExtras(o);let a=`<div class="container"><div class="fecha-hora"><p>${e.fecha.replace(/,/g,"-")}</p><p>${e.horario}(${e.horaExtras})</p></div><div><p>Rec. Noc:</p><p>$${recargoNocturnos}</p></div><div><p>Rec. Dom:</p><p>$${recargoDominical}</p></div><div><p>Dom. Noc:</p><p>$${recargoDominicalNoc}</p></div></div>`;drawPago.innerHTML+=a,extrasDominicalesNoc=0,extrasNocturnas=0,extraOrdinaria=0,extraDominicales=0,recargoNocturnos=0,recargoDominicalNoc=0,recargoDominical=0,horaExtras=0});let a=totalDom+totalDomNoc+totalNoc+salarioBase+subsidioTransporte+totalOrdinaria+totalExtraNoc+totalExtraDom+totalExtraDomNoc,r=(a=a-(deduccionAFP=.04*(a-subsidioTransporte))+(deduccionEPS=.04*(a-subsidioTransporte)))-deduccionAFP-deduccionEPS,t=`<p class="totalNomina">Total Nomina: $${moneda(Math.round(r))}</p><div class="total"><p>Salario Base</p><p>$${moneda(salarioBase)}</p></div><div class="total"><p>Subsidio de transporte</p><p>$${moneda(subsidioTransporte)}</p></div><div class="total"><p>Rec. Nocturnos:</p><p>$${moneda(totalNoc)}</p></div><div class="total"><p>Rec. Dominicales:</p><p>$${moneda(totalDom)}</p></div><div class="total"><p>Rec. Dominicales Noc.:</p><p>$${moneda(totalDomNoc)}</p></div><div class="total"><p>Deducción EPS:</p><p>-$${moneda(Math.round(deduccionEPS))}</p></div><div class="total"><p>Deducción AFP:</p><p>-$${moneda(Math.round(deduccionAFP))}</p></div>`;totales.innerHTML=t,totalOrdinaria>0&&agregarHora(totales,"Total HE Ordinaria",totalOrdinaria,"totalHEOrd",horasXOrd),totalExtraNoc>0&&agregarHora(totales,"Total HE Noc.",totalExtraNoc,"totalHENoc",horasXNoc),totalExtraDom>0&&agregarHora(totales,"Total HE Dom. Or.",totalExtraDom,"totalHEDom",horasXDom),totalExtraDomNoc>0&&agregarHora(totales,"Total HE Dom. Noc.",totalExtraDomNoc,"totalHEDomNoc",horasXDomNoc)}function agregarHora(e,o,a,r,t){let c=document.createElement("div"),n=document.createElement("p"),l=document.createElement("p");c.classList.add("total"),n.classList.add(r),n.innerHTML=`${o}: (${t})`,l.innerHTML=`$${moneda(Math.round(a))}`,c.appendChild(n),c.appendChild(l),e.appendChild(c)}function moneda(e){return Intl.NumberFormat("es-IN",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e)}function calcExtras(e){let o=e.getHours(),a=e.getDay();o>21||o<=5?0==a?(extrasDominicalesNoc+=vrHrExNocFoFes/4,totalExtraDomNoc+=vrHrExNocFoFes/4,horasXDomNoc+=.25):(extrasNocturnas+=vrHrExNocOr/4,totalExtraNoc+=vrHrExNocOr/4,horasXNoc+=.25):0==a?(extraDominicales+=vrHrExDiDoFes/4,totalExtraDom+=vrHrExDiDoFes/4,horasXDom+=.25):(extraOrdinaria+=vrHrExDiOr/4,totalOrdinaria+=vrHrExDiOr/4,horasXOrd+=.25),e.setTime(e.getTime()+9e5)}function calcNomina(e){let o=e.getHours(),a=e.getDay();o>=21||o<=5?0==a?(recargoDominicalNoc+=vrRecNocDoFes,totalDomNoc+=vrRecNocDoFes):(recargoNocturnos+=vrRecNocOr,totalNoc+=vrRecNocOr):0==a&&(recargoDominical+=vrRecDom,totalDom+=vrRecDom),e.setTime(e.getTime()+36e5)}function cambiarEsquema(){let e=document.querySelectorAll("h1, .mes-head, .day-container, .modal-titulo, .confirmar"),o=document.querySelectorAll(".rol");for(let e=0;e<o.length;e++){o[e].addEventListener("click",a)}function a(){!function(a){for(let e=0;e<o.length;e++){const a=o[e];a.classList.remove("active")}a.classList.add("active");for(let o=0;o<e.length;o++)currentColor=getComputedStyle(a).backgroundColor,e[o].style.backgroundColor=currentColor;switch(a.textContent){case"Supervisor":salarioBase=1591335;break;case"Conductor":salarioBase=115e4;break;default:salarioBase=1e6}}(selected=this)}}document.querySelector(".previo").addEventListener("click",()=>{fecha.setMonth(fecha.getMonth()-1),generarCalendario()}),document.querySelector(".posterior").addEventListener("click",()=>{fecha.setMonth(fecha.getMonth()+1),generarCalendario()}),selecthe(),cerrar.addEventListener("click",()=>{modal.classList.remove("modalOpen")}),terminar.addEventListener("click",()=>{let e=fecha.getMonth(),o=fecha.getMonth()+1;drawPago.innerHTML="",consolidarNomina(e,o),document.querySelector(".drawNomina").style.display="flex",cerrarNomina.addEventListener("click",()=>{document.querySelector(".drawNomina").style.display="none",document.querySelector(".calendar").style.display="flex",totalDom=0,totalDomNoc=0,totalNoc=0,totalOrdinaria=0,totalExtraDom=0,totalExtraNoc=0,totalExtraDomNoc=0,horasXDom=0,horasXDomNoc=0,horasXOrd=0,horasXNoc=0}),document.querySelector(".calendar").style.display="none"}),guardar.addEventListener("click",()=>{agregarJson(turno.value,diafechado,horaExtras),recuperarFechas(),turno.value="",horaExtras=0;for(let e=0;e<horasPlus.length;e++)horasPlus[e].classList.remove("active")}),generarCalendario();